<html>

<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<style>
	/*Search box styles*/
		* {
			box-sizing: border-box;
		}

		.searchBox input[type=text] {
			padding: 6px;
			margin-top: 8px;
			font-size: 17px;
			border: none;
		}

		.searchBox button {
			/* float: right; */
			padding: 6px 10px;
			margin-top: 8px;
			margin-right: 16px;
			background: #ddd;
			font-size: 17px;
			border: none;
			cursor: pointer;
		}


		.searchBox button:hover {
			background: #ccc;
		}

		@media screen and (max-width: 600px) {
			.searchBox {
				float: none;
			}
			.searchBox input[type=text],
			.searchBox button {
				float: none;
				display: block;
				text-align: left;
				width: 100%;
				margin: 0;
				padding: 14px;
			}
			.searchBox input[type=text] {
				border: 1px solid #ccc;
			}
		}

		/**
			* Styles for content boxes and hover popups
			*/
		.contentBox{
			position: absolute;
			z-index: 2;
			background-color: rgba(47, 124, 147, 0.8);
			color: #fff;
			padding: 8px 12px;
			right: 5px;
			top: 10rem;
			width: 25%;
			height: 50%;
			overflow-x: hidden;
		}

		.popup{
			background-color: rgba(255,74,0,0.8);
		}
	</style>
</head>

<body>
	{% extends 'dpsite/base.html' %}
	{% load static %}
	{% block content %}
	<!--Search Box-->
	<div class="searchBox">
		<!-- <form action="/action_page.php"> -->
		<input type="text" placeholder="Search.." name="search">
		<button type="submit"><i class="fa fa-search"></i></button>
		<!-- </form> -->
	</div>

	<!--Content-->
	<div class="contentBox">
		<!--Header of the location; default: "Diggin'Philly"-->
		<h6 style="color:black;"><strong><div id="content-header" href=#>
			Diggin' Philly: The Black Philadelphia Project
		</div></strong></h6>
		<!--Image if one exists-->
		<div></div>
		<!--Neighboord and date, if one exists-->
		<p><strong><div id="content-neighborhood-dates">

		</div></strong></p>

		<!--Summary of data; default: project description-->
		<p><div id="content-summary">
			Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
		</div></p>

		<!--Media, if it exists-->
		<div id="media, if it exists">
		</div>
	</div>

	<!--Map and popup items-->
	<div id="map"></div>
	<div id="popup" class="popup"></div>


	<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
	<link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
	<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
	<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
	<script>
		/**
		 * Elements that make up the popup.
		 */
		var container = document.getElementById('popup');

		/**
		 * Create an overlay to anchor the popup to the map.
		 */
		var overlay = new ol.Overlay({
			element: container,
			autoPan: true,
			autoPanAnimation: {
				duration: 250
			}
		});

		/**
		 * Create the map.
		 */
		var map = new ol.Map({
			layers: [
				new ol.layer.Tile({
					source: new ol.source.XYZ({
						url: 'https://api.mapbox.com/styles/v1/mirandamote/cjig4g2e218z52rqk7zaovjm9/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoibWlyYW5kYW1vdGUiLCJhIjoiY2ppZzRldDh0MGM2OTNxbzUwcnR5d3JyNiJ9.PVzMeD6NKLhtcIJFkv7ytQ'
					})
				})
			],
			overlays: [overlay],
			target: 'map',
			view: new ol.View({
				center: ol.proj.fromLonLat([-75.165222, 39.952583]),
				zoom: 12,
				minZoom: 10,
        maxZoom: 19,
			})
		});

		/**
			* Create a feature for each data point we have
			*/
		{% for mapItem in map_items %}
		{% for point in mapItem.location1 %}
		var markers = new ol.layer.Vector({
			source: new ol.source.Vector({
				features: [
					new ol.Feature({
						title:"{{mapItem.title|safe|striptags}}",
						summary: '{{mapItem.summary|safe|striptags}}',
						description:'{{mapItem.description|safe|striptags}}',
						start:'{{mapItem.start_date|safe|striptags}}',
						end:'{{mapItem.end_date|safe|striptags}}',
						media:'{{mapItem.media|safe}}',
						geometry: new ol.geom.Point(ol.proj.fromLonLat([{{point.coords.0}}, {{point.coords.1}}])),
					})
				]
			}),
			style: new ol.style.Style({
				image: new ol.style.Icon({
					src: 'https://s8.postimg.cc/gcsd9zztx/target.png',
					width:10,
					anchor: [0.5, 1]
				})
			})
		});
		map.addLayer(markers);
		{% endfor %}
		{% endfor %}

		/**
			* Creating an overlay with popups
			*/
		const element = document.getElementById('popup');

		const popup = new ol.Overlay({
      element: element,
      positioning: 'bottom-center',
      stopEvent: false,
    });

    map.addOverlay(popup);

		/**
		 * Create an overlay box in the top right hand corner
		 */

		/**
		 * Add a click handler to the map to render the popup.
		 */
		map.on('singleclick', function(evt) {
			const feature = map.forEachFeatureAtPixel(evt.pixel,
          function(feature) {
            return feature;
          });

				// Handle click on map item
        if (feature) {
					// Handle content change
					document.getElementById('content-header').innerHTML = feature.get('title');
					document.getElementById('content-neighborhood-dates').innerHTML = feature.get('start') + '-' + feature.get('end');
					document.getElementById('content-summary').innerHTML = feature.get('summary');
          // Handle popup
          const coordinates = feature.getGeometry().getCoordinates();
          popup.setPosition(coordinates);
					$(element).popover({
            placement: 'right',
            html: true,
            content: feature.get('title')
          });
          $(element).popover('show');

				// Dispose popup and return to default text otherwise
        } else {
          $(element).popover('dispose');
					document.getElementById('content-header').innerHTML ="Diggin' Philly: The Black Philadelphia Project";
					document.getElementById('content-summary').innerHTML = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim idest laborum.';

        }
		});

		map.on('pointermove', function(evt) {
        if (evt.dragging) {
          $(element).popover('dispose');
          return;
        }
        map.getTargetElement().style.cursor = map.hasFeatureAtPixel(evt.pixel) ? 'pointer' : '';
      });
	</script>
	{% endblock %}
</body>

</html>
