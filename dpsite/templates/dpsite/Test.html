<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<style>
	* {box-sizing: border-box;}

	/* Create two equal columns that floats next to each other */
	.column {
		float: left;
		width: 50%;
		padding: 10px;

	}

	/* Clear floats after the columns */
	.row:after {
		content: "";
		display: table;
		clear: both;
	}

	.searchBox input[type=text] {
		padding: 6px;
		margin-top: 8px;
		font-size: 17px;
		border: none;
	}
	.searchBox button {
		/* float: right; */
		padding: 6px 10px;
		margin-top: 8px;
		margin-right: 16px;
		background: #ddd;
		font-size: 17px;
		border: none;
		cursor: pointer;
	}


	.searchBox button:hover {
		background: #ccc;
	}

	@media screen and (max-width: 600px) {
		.searchBox {
			float: none;
		}
		.searchBox input[type=text], .searchBox button {
			float: none;
			display: block;
			text-align: left;
			width: 100%;
			margin: 0;
			padding: 14px;
		}
		.searchBox input[type=text] {
			border: 1px solid #ccc;
		}
	}
	/* styling checkbox */
	/* The container */
	.container {
		display: block;
		position: relative;
		left:60;
		padding-left: 35px;
		margin-bottom: 12px;

		cursor: pointer;
		font-size: 16px;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

	/* Hide the browser's default checkbox */
	.container input {
		position: absolute;
		opacity: 0;
		cursor: pointer;
	}

	/* Create a custom checkbox */
	.checkmark {
		position: absolute;
		top: 0;
		left: -20;
		height: 25px;
		width: 25px;
		background-color: #eee;
	}

	/* Create a custom radio button */
.radioCheckmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 25px;
    width: 25px;
    background-color: #eee;
    border-radius: 50%;
}


	/* On mouse-over, add a grey background color */
	.container:hover input ~ .checkmark {
		background-color: #ccc;
	}

	/* When the checkbox is checked, add a blue background */
	.container input:checked ~ .checkmark {
		background-color: #2196F3;
	}

	/* Create the checkmark/indicator (hidden when not checked) */
	.checkmark:after {
		content: "";
		position: absolute;
		display: none;
	}

	/* Show the checkmark when checked */
	.container input:checked ~ .checkmark:after {
		display: block;
	}

	/* Style the checkmark/indicator */
	.container .checkmark:after {
		left: 9px;
		top: 5px;
		width: 5px;
		height: 10px;
		border: solid white;
		border-width: 0 3px 3px 0;
		-webkit-transform: rotate(45deg);
		-ms-transform: rotate(45deg);
		transform: rotate(45deg);
	}
	/* Style the indicator (dot/circle) */
.radioContainer .radioCheckmark:after {
 	top: 9px;
	left: 9px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: white;
}
.slidecontainer {
    width: 100%;
}

.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 25px;
    background: #eee;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.slider:hover {
    opacity: 1;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    background: #000000;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 25px;
    height: 25px;
    background: #4CAF50;
    cursor: pointer;
}

	</style>
</head>

<body>
	{% extends 'dpsite/base.html' %}

	{% block content %}
	<div class="searchBox">

		<input type="text" id = "query" placeholder="Search.." name="search">
		<button type="submit" id = "submitButton"><i class="fa fa-search"></i></button>
	</div>

	<div class="row">

		<div class="column">
			<h2>Theme</h2>
			<label class="container">Education
				<input type="checkbox" name = "tag" value = "education">

				<span class="checkmark"></span>

			</label>

			<label class="container">Museum
				<input type="checkbox" name = "tag" value = "museum">
				<span class="checkmark"></span>
			</label>

			<label class="container">Historic Firsts
				<input type="checkbox" name = "tag" value = "Historic Firsts">
				<span class="checkmark"></span>
			</label>

			<label class="container">Religion
				<input type="checkbox" name = "tag" value = "Religion">
				<span class="checkmark"></span>
			</label>

			<label class="container">Arts or Culture

				<input type = "checkbox" name = "tag" value = "Arts or Culture">
				<span class="checkmark"></span>
			</label>

			<label class="container">Building
				<input type="checkbox" name = "tag" value = "Building">
				<span class="checkmark"></span>
			</label>

			<label class="container">Murals
				<input type="checkbox" name = "tag" value = "Murals">
				<span class="checkmark"></span>
			</label>

			<label class="container">Activism
				<input type="checkbox" name = "tag" value = "Activism">
				<span class="checkmark"></span>
			</label>

			<label class="container">Oral History
				<input type="checkbox" name = "tag" value = "Oral History">
				<span class="checkmark"></span>
			</label>

			<label class="container">Public Spaces
				<input type="checkbox" name = "tag" value = "Public Spaces">
				<span class="checkmark"></span>
			</label>

			<label class="container">Monument
				<input type="checkbox" name = "tag" value = "Monument">
				<span class="checkmark"></span>
			</label>

			<label class="container">Politics
				<input type="checkbox" name = "tag" value = "Politics">
				<span class="checkmark"></span>
			</label>

			<label class="container">Historic Events
				<input type="checkbox" name = "tag" value = "Historic Events">
				<span class="checkmark"></span>
			</label>

			<label class="container">Image
				<input type="checkbox" name = "tag" value = "Image">
				<span class="checkmark"></span>
			</label>

			<label class="container">Video
				<input type="checkbox" name = "tag" value = "Video">
				<span class="checkmark"></span>
			</label>

			<label class="container">Organization
				<input type="checkbox" name = "tag" value = "Organization">
				<span class="checkmark"></span>
			</label>

			<label class="container">Events
				<input type="checkbox" name = "tag" value = "Events">
				<span class="checkmark"></span>
			</label>

			<label class="container">Historic Marker
				<input type="checkbox" name = "tag" value = "Historic Marker">
				<span class="checkmark"></span>
			</label>

			<label class="container">People
				<input type="checkbox" name = "tag" value = "People">
				<span class="checkmark"></span>
			</label>

			<label class="container">360 Video
				<input type="checkbox" name = "tag" value = "360 Video">
				<span class="checkmark"></span>
			</label>
		</div>

		<div class="column">
			<h2>Part of City</h2>
			<!-- Octavius Catto    House: South Philly, Monument: Center City -->
			<label class="radioContainer">North Philadelphia
				<input type="radio" name = "location" value = "North Philadelphia">
				<span class="radioCheckmark"></span>
			</label>
			<label class="radioContainer">West Philadelphia
				<input type="radio" name = "location" value = "West Philadelphia">
				<span class="radioCheckmark"></span>
			</label>

			<label class="radioContainer">South Philadelphia
				<input type="radio" name = "location" value = "South Philadelphia">
				<span class="radioCheckmark"></span>
			</label>

			<h2>Time Period</h2>
			<div class="slidecontainer">
  		<input type="range" min="1900" max="2018" value="2000" class="slider" id="sliderRange">
  		<p>Year: <span id="sliderValue"></span></p>
			</div>

		</div>
	</div>




	<button type="button" class="btn btn-primary" onclick="selectTag()">
		Filter By Tags
	</button>
	<button type="button" class="btn btn-primary" onclick="selectPartOfCity()">
		Filter By Part Of City
	</button>
	<button type="button" class="btn btn-primary" onclick="selectTimePeriod()">
		Filter By Time Period
	</button>

	<span id='logMsg'><!-- Use this span for writing debug messages --></span>

	<!-- Temporary modal button -->
	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
		Launch demo modal
	</button>

	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content" style="background:rgba(47,124,147,0.85);" >
				<div class="modal-body" style="color: white;">
					<h4 style="color: black;"><strong>Site of MOVE Bombing</strong></h4>
					<img class="img-responsive" src="https://image.freepik.com/free-photo/cute-cat-picture_1122-449.jpg" style="width: 100%;">
					<p style="color:black;"><strong>Modal content will go here.</strong></p>
					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</p>
					<div class="embed-container">
						<iframe style="height: 50%; width: 100%;" src="https://www.youtube.com/embed/LAqG0wcTfV4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
					</div>
				</div>
			</div> <!--end modal content-->
		</div> <!--end modal dialogue-->
	</div> <!--end modal-->

	<div id="map" class="map"></div>
	<div id="popup" class="ol-popup">
		<a href="#" id="popup-closer" class="ol-popup-closer"></a>
		<div id="popup-content"></div>
	</div>



	<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
	<link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
	<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
	<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>

	const queryInput = document.getElementById('query');
	const searchButton = document.getElementById('submitButton');

	function search(query) {
		$('#logMsg').html(queryInput.value);

		{% for mapItem in map_items%}
		if ('{{mapItem.title}}'.includes(queryInput.value) || '{{mapItem.summary}}'.includes(queryInput.value)) {
			$('#logMsg').append('{{mapItem.title}}');

		}

		{% endfor %}

	}

	searchButton.onclick = function(event) {
		$('#logMsg').html(queryInput.value);
		search(queryInput.value);
		event.preventDefault();
	};

	// function for tag selection
	function selectTag() {
		$('#logMsg').html("");
		var checkBox = document.getElementsByName("tag");

		var selectedItems = "selected: ";
		for (var i = 0; i< checkBox.length; i++) {
			// $('#logMsg').append("true " + checkBox[i].checked);
			if (checkBox[i].checked == true) {
				// $('#logMsg').append(checkBox[i].value);\
				selectedItems += checkBox[i].value + "\n";
				{% for mapItem in map_items%}

				{%for t in mapItem.tags.all%}
				if ('{{t}}'==checkBox[i].value) {
					$('#logMsg').append('{{mapItem}}');
				}

				{% endfor %}

				// \{% endfor %\}\
				{% endfor %}
			}

		}
		$('#logMsg').append(selectedItems);

	}

	// function for part of city selection
	function selectPartOfCity() {
		$('#logMsg').html("");
		var checkBox = document.getElementsByName("location");

		for (var i = 0; i< checkBox.length; i++) {

			if (checkBox[i].checked == true) {

				// $('#logMsg').append("checked");
				{% for mapItem in map_items%}
				// $('#logMsg').append('{{mapItem}}');

				if ('{{mapItem.location_notes}}'==checkBox[i].value) {
					$('#logMsg').append('{{mapItem}}');
				}




				{% endfor %}
				break;
			}

		}

	}


	var slider = document.getElementById("sliderRange");
	var output = document.getElementById("sliderValue");
	output.innerHTML = slider.value;

	slider.oninput = function() {
  	output.innerHTML = this.value;
	}

	function selectTimePeriod() {
		$('#logMsg').html("");
		// $('#logMsg').append(slider.value);
		{% for mapItem in map_items%}
		var startDate = '{{mapItem.start_date}}';
		var startYear = startDate.substr(startDate.indexOf(",")+1);
		var endDate = '{{mapItem.end_date}}';
		var endYear = endDate.substr(endDate.indexOf(",")+1);
		// $('#logMsg').append("start year: " + startYear);
		// $('#logMsg').append("end year: " + endYear);
	// && endYear >=slider.value
		if (startYear <= slider.value && slider.value >= endYear) {
			$('#logMsg').append('{{mapItem}}');
		}
		// var year = '{{mapItem.start_date}}'.substr(str.indexOf(",")+1);

		{% endfor %}
	}

	/**
	* Elements that make up the popup.
	*/
	var container = document.getElementById('popup');
	var content = document.getElementById('popup-content');
	var closer = document.getElementById('popup-closer');


	/**
	* Add a click handler to hide the popup.
	* @return {boolean} Don't follow the href.
	*/
	closer.onclick = function() {
		overlay.setPosition(undefined);
		closer.blur();
		return false;
	};


	/**
	* Create an overlay to anchor the popup to the map.
	*/
	var overlay = new ol.Overlay({
		element: container,
		autoPan: true,
		autoPanAnimation: {
			duration: 250
		}
	});


	/**
	* Create the map.
	*/
	var map = new ol.Map({
		layers: [
			new ol.layer.Tile({
				source: new ol.source.XYZ({
					url: 'https://api.mapbox.com/styles/v1/mirandamote/cjig4g2e218z52rqk7zaovjm9/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoibWlyYW5kYW1vdGUiLCJhIjoiY2ppZzRldDh0MGM2OTNxbzUwcnR5d3JyNiJ9.PVzMeD6NKLhtcIJFkv7ytQ'

				})
			})
		],
		overlays: [overlay],
		target: 'map',
		view: new ol.View({
			center: ol.proj.fromLonLat([-75.165222, 39.952583]),
			zoom: 12
		})
	});

	{% for mapItem in map_items%}
	{% for point in mapItem.location1%}
	var markers = new ol.layer.Vector({
		source: new ol.source.Vector({
			features: [
				new ol.Feature({
					geometry: new ol.geom.Point(ol.proj.fromLonLat([{{point.coords.0}} , {{point.coords.1}}])),

				})

			]
		}),
		style: new ol.style.Style({
			image: new ol.style.Icon({
				src: '//openlayers.org/en/v3.12.1/examples/data/icon.png',
				anchor: [0.5, 1]
			})
		})
	});
	map.addLayer(markers);
	{% endfor %}
	{% endfor %}

	/**
	* Add a click handler to the map to render the popup.
	*/
	map.on('singleclick', function(evt) {
		var name = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
			return feature.get('name');
		})
		var coordinate = evt.coordinate;
		content.innerHTML = name;
		overlay.setPosition(coordinate);
	});
	map.on('pointermove', function(evt) {
		map.getTargetElement().style.cursor = map.hasFeatureAtPixel(evt.pixel) ? 'pointer' : '';
	});

</script>
<script>
// Get the modal
var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
	modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
	modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
	if (event.target == modal) {
		modal.style.display = "none";
	}
}
</script>
{% endblock %}
</body></html>
